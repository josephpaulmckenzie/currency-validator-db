<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Success Page</title>

		<style>
			body {
				font-family: Arial, sans-serif;
				background-color: #f0f0f0;
				margin: 0;
				padding: 0;
			}

			.container {
				max-width: 600px;
				margin: 20px auto;
				padding: 20px;
				background-color: #fff;
				border-radius: 8px;
				box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
			}

			h1,
			h2 {
				text-align: center;
			}

			form div {
				margin-bottom: 10px;
			}

			label {
				font-weight: bold;
				display: block;
				margin-bottom: 5px;
				text-align: center;
			}

			input[type='text'] {
				width: 100%;
				padding: 8px;
				border: 1px solid #ccc;
				border-radius: 4px;
				box-sizing: border-box;
			}

			button[type='submit'] {
				background-color: #007bff;
				color: #fff;
				padding: 10px 20px;
				border: none;
				border-radius: 4px;
				cursor: pointer;
				display: block;
				margin: 20px auto 0;
			}

			button[type='submit']:hover {
				background-color: #0056b3;
			}

			/* Style for the preview image container */
			.preview-container {
				display: flex; /* Use flexbox for centering */
				justify-content: center; /* Center horizontally */
				align-items: center; /* Center vertically */
				height: auto; /* Set container height to auto */
				position: relative; /* Make the container relative for absolute positioning */
			}

			/* Style for the preview image */
			#previewImage {
				max-width: 100%; /* Set maximum width to 100% of container width */
				max-height: 90vh; /* Set maximum height to 90% of viewport height */
				border: 1px solid #ccc; /* Add a border for visual clarity */
				border-radius: 4px; /* Add border-radius for rounded corners */
				cursor: pointer; /* Change cursor to pointer on hover */
			}

			/* Style for the enlarged image overlay */
			#enlargedImage {
				display: none; /* Initially hide the enlarged image */
				position: fixed; /* Position the enlarged image fixed to the viewport */
				top: 0;
				left: 0;
				width: 100%; /* Make the enlarged image take up the full width of the viewport */
				height: 100%; /* Make the enlarged image take up the full height of the viewport */
				background-color: rgba(0, 0, 0, 0.8); /* Semi-transparent black background */
				z-index: 9999; /* Set z-index to ensure it appears above other elements */
				text-align: center; /* Center the image horizontally and vertically */
				overflow: auto; /* Allow scrolling if the image is larger than the viewport */
			}

			/* Style for the enlarged image itself */
			#enlargedImage img {
				margin: 20px auto; /* Add some margin for visual appeal */
				max-width: 90%; /* Limit the maximum width of the enlarged image */
				max-height: 90%; /* Limit the maximum height of the enlarged image */
			}

			/* Style for the close button */
			#closeBtn {
				position: absolute; /* Position the close button relative to its containing div */
				top: 20px;
				right: 20px;
				color: white;
				font-size: 24px;
				cursor: pointer;
			}
			/* Style for the bounding box */
			.bounding-box {
				position: absolute;
				border: 2px solid red;
				z-index: 50; /* Ensure bounding boxes appear above the enlarged image overlay */
				/* pointer-events: none; Make the bounding box not clickable */
			}

			/* CSS */
			.tooltip {
				position: absolute;
				background-color: #f0f0f0;
				border: 1px solid #ccc;
				border-radius: 4px;
				padding: 8px;
				display: none;
				z-index: 100; /* Ensure tooltips appear above the enlarged image overlay */
			}
		</style>
	</head>

	<body>
		<div class="container">
			<h1>Upload Successful</h1>
			<form id="dataForm" action="/save" method="POST">
				<div class="preview-container">
					<!-- Preview Image -->
					<img id="previewImage" src="<%= dataURL %>" alt="Preview Image" />
				</div>

				<!-- Enlarged Image Overlay -->
				<div id="enlargedImage">
					<span id="closeBtn">&times;</span>
					<img id="enlargedImg" src="" alt="Enlarged Image" />
				</div>

				<!-- Form fields for editing response data -->
				<div>
					<label for="validDenomination">Valid Denomination:</label>
					<input type="text" id="validDenomination" name="validDenomination" value="<%= detectedText.validDenomination.text %>" />
				</div>
				<label for="frontPlateId" id="frontPlateLabel">Front Plate ID:<span class="tooltip" id="frontPlateTooltip"></span></label>
				<input type="text" id="frontPlateId" name="frontPlateId" value="<%= detectedText.frontPlateId.text %>" />

				<div>
					<label for="SerialPatternMatch">Serial Pattern Match:</label>
					<input type="text" id="SerialPatternMatch" name="SerialPatternMatch" value="<%= detectedText.SerialPatternMatch.text %>" />
				</div>
				<div>
					<label for="serialNumber">Serial Number:</label>
					<input type="text" id="serialNumber" name="serialNumber" value="<%= detectedText.serialNumber.text %>" />
				</div>
				<div>
					<label for="federalReserveId">Federal Reserve ID:</label>
					<input type="text" id="federalReserveId" name="federalReserveId" value="<%= detectedText.federalReserveId.text %>" />
				</div>
				<div>
					<label for="federalReserveLocation">Federal Reserve Location:</label>
					<input type="text" id="federalReserveLocation" name="federalReserveLocation" value="<%= detectedText.federalReserveLocation %>" />
				</div>
				<div>
					<label for="notePositionId">Note Position Id:</label>
					<input type="text" id="notePositionId" name="notePositionId" value="<%= detectedText.notePositionId.text %>" />
				</div>
				<div>
					<label for="seriesYear">Series Year:</label>
					<input type="text" id="seriesYear" name="seriesYear" value="<%= detectedText.seriesYear %>" />
				</div>
				<div>
					<label for="treasurer">Treasurer:</label>
					<input type="text" id="treasurer" name="treasurer" value="<%= detectedText.treasurer.text %>" />
				</div>
				<div>
					<label for="secretary">Secretary:</label>
					<input type="text" id="secretary" name="secretary" value="<%= detectedText.secretary.text %>" />
				</div>

				<!-- Submit button to save changes -->
				<button type="submit">Save Changes</button>
			</form>
		</div>
		<script>
			// const previewImage = document.getElementById('previewImage');
			const enlargedImage = document.getElementById('enlargedImage');
			const enlargedImg = document.getElementById('enlargedImg');
			const closeBtn = document.getElementById('closeBtn');

			// Event listener for preview image click to toggle enlarged image overlay
			previewImage.addEventListener('click', () => {
				if (enlargedImage.style.display === 'block') {
					enlargedImage.style.display = 'none'; // Hide the enlarged image overlay
				} else {
					enlargedImg.src = previewImage.src; // Set the source of the enlarged image
					enlargedImage.style.display = 'block'; // Show the enlarged image overlay
				}
			});

			// Event listener for form field click to draw or remove bounding box
			const formFields = document.querySelectorAll('input[type="text"]');
			formFields.forEach((field) => {
				let boundingBoxDrawn = false; // Track if a bounding box is drawn
				field.addEventListener('click', () => {
					if (!boundingBoxDrawn) {
						// Get bounding box coordinates for the corresponding field
						const boundingBox = getBoundingBox(field.id);
						// console.log(boundingBox);
						// Draw a box around the area on the image
						drawBox(boundingBox);
						boundingBoxDrawn = true;
					} else {
						// If bounding box is already drawn, remove it
						removeBox();
						boundingBoxDrawn = false;
					}
				});
			});

			// Function to remove the bounding box
			function removeBox() {
				const existingBox = document.querySelector('.bounding-box');
				if (existingBox) {
					existingBox.parentNode.removeChild(existingBox);
				}
			}

			// Function to get bounding box coordinates based on form field id
			function getBoundingBox(fieldId) {
				// Accessing dynamically based on fieldId
				const detectedTextStr = '<%- JSON.stringify(detectedText) %>';
				const detectedText = JSON.parse(detectedTextStr);
				const boundingBoxDetails = detectedText[fieldId].boundingBox;
				// console.log('BBDetails', boundingBoxDetails);

				// Calculate bounding box coordinates relative to the preview image dimensions
				const previewWidth = previewImage.clientWidth;
				const previewHeight = previewImage.clientHeight;
				const left = boundingBoxDetails.Left * previewWidth;
				const top = boundingBoxDetails.Top * previewHeight;
				const width = boundingBoxDetails.Width * previewWidth;
				const height = boundingBoxDetails.Height * previewHeight;

				return { left, top, width, height };
			}

			// Function to draw a box around the specified area on the image
			function drawBox(boundingBox) {
				const box = document.createElement('div');
				box.className = 'bounding-box';
				box.style.left = `${boundingBox.left}px`;
				box.style.top = `${boundingBox.top}px`;
				box.style.width = `${boundingBox.width}px`;
				box.style.height = `${boundingBox.height}px`;

				// Append the box to the preview image container
				if (previewImage.parentElement) {
					previewImage.parentElement.appendChild(box);
				}
			}
			const tooltips = {
				validDenomination: 'Denomination',
				frontPlateId: 'Front Plate ID',
				SerialPatternMatch: 'Type of Cool serial number',
				serialNumber: 'Serial Number',
				federalReserveId: 'Federal Reserve ID',
				federalReserveLocation: 'Federal Reserve Location',
				notePositionId: 'Note Position ID',
				seriesYear: 'Series Year',
				treasurer: 'Treasurer',
				secretary: 'Secretary',
			};
			// Add tooltips to form fields
			formFields.forEach((field) => {
				// Get the corresponding label and create a tooltip element
				const label = document.querySelector(`label[for="${field.id}"]`);
				const tooltip = document.createElement('span');
				tooltip.className = 'tooltip';

				// Get the tooltip message based on the field name
				const tooltipMessage = tooltips[field.id];

				// Set tooltip content
				tooltip.textContent = tooltipMessage;

				// Append the tooltip to the label
				label.appendChild(tooltip);

				// Show tooltip when hovering over the label
				label.addEventListener('mouseover', () => {
					tooltip.style.display = 'block';
				});

				// Hide tooltip when mouse leaves the label
				label.addEventListener('mouseout', () => {
					tooltip.style.display = 'none';
				});
			});

			// Add tooltips to bounding boxes on the image
			document.querySelectorAll('.bounding-box').forEach((box) => {
				// Get the corresponding tooltip
				const tooltip = box.querySelector('.tooltip');
				console.log(tooltip);
				// Show tooltip when hovering over the bounding box
				box.addEventListener('mouseover', () => {
					tooltip.style.display = 'block';
				});

				// Hide tooltip when mouse leaves the bounding box
				box.addEventListener('mouseout', () => {
					tooltip.style.display = 'none';
				});
			});

			// Event listener for close button click to hide the enlarged image overlay
			closeBtn.addEventListener('click', () => {
				enlargedImage.style.display = 'none'; // Hide the enlarged image overlay
			});
		</script>
	</body>
</html>
